<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G2B单词复习打卡</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .module-selector {
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
            flex-grow: 1;
        }
        .chinese {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
        }
        .answer {
            min-height: 60px;
            font-size: 28px;
            color: #27ae60;
            margin: 25px 0;
            padding: 15px;
            background-color: #e8f5e9;
            border-radius: 5px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        .show-answer {
            background-color: #3498db;
            color: white;
            width: 100%;
        }
        .show-answer:hover {
            background-color: #2980b9;
        }
        .remembered {
            background-color: #2ecc71;
            color: white;
            flex: 1;
        }
        .remembered:hover {
            background-color: #27ae60;
        }
        .not-remembered {
            background-color: #e74c3c;
            color: white;
            flex: 1;
        }
        .not-remembered:hover {
            background-color: #c0392b;
        }
        .progress {
            margin-top: 20px;
            text-align: center;
            font-size: 18px;
            color: #7f8c8d;
        }
        .completed {
            color: #27ae60;
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
        .module-btn {
            padding: 8px 15px;
            margin: 5px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .module-btn.active {
            background-color: #2c3e50;
        }
        .reset-btn {
            background-color: #95a5a6;
            color: white;
            margin-top: 10px;
        }
        .reset-btn:hover {
            background-color: #7f8c8d;
        }
        .finish-btn {
            background-color: #9b59b6;
            color: white;
            margin-top: 10px;
        }
        .finish-btn:hover {
            background-color: #8e44ad;
        }
        .not-remembered-list {
            margin-top: 20px;
            padding: 15px;
            background-color: #fdedec;
            border-radius: 5px;
            display: none;
        }
        .not-remembered-list h3 {
            color: #c0392b;
            margin-top: 0;
        }
        .not-remembered-list ul {
            list-style-type: none;
            padding: 0;
        }
        .not-remembered-list li {
            padding: 5px 0;
            border-bottom: 1px solid #f5b7b1;
        }
        .email-form {
            display: none;
            margin-top: 20px;
        }
        .word-type-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .word-type-btn {
            padding: 8px 15px;
            margin: 0 5px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .word-type-btn.active {
            background-color: #2c3e50;
        }
        .footer-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .email-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .email-form-group {
            margin-bottom: 15px;
        }
        .email-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>G2B单词复习打卡</h1>
    
    <div class="module-selector">
        <button class="module-btn active" data-module="m1u1">M1U1</button>
        <button class="module-btn" data-module="m1u2">M1U2</button>
        <button class="module-btn" data-module="m1u3">M1U3</button>
        <button class="module-btn" data-module="m2u1">M2U1</button>
        <button class="module-btn" data-module="m2u2">M2U2</button>
        <button class="module-btn" data-module="m2u3">M2U3</button>
        <button class="module-btn" data-module="m3u1">M3U1</button>
        <button class="module-btn" data-module="m3u2">M3U2</button>
        <button class="module-btn" data-module="m3u3">M3U3</button>
        <button class="module-btn" data-module="m4u1">M4U1</button>
        <button class="module-btn" data-module="m4u2">M4U2</button>
        <button class="module-btn" data-module="m4u3">M4U3</button>
    </div>
    
    <div class="word-type-tabs">
        <button class="word-type-btn active" data-type="words">单词</button>
        <button class="word-type-btn" data-type="phrases">词组</button>
        <button class="word-type-btn" data-type="sentences">句子</button>
    </div>
    
    <!-- Word Containers for each module -->
    <div id="m1u1-words" class="word-container">
        <div class="progress">进度: <span id="m1u1-progress">0</span>/<span id="m1u1-total">0</span> (<span id="m1u1-completed">0</span> 已记住)</div>
        <div id="m1u1-card" class="card">
            <div class="chinese" id="m1u1-chinese"></div>
            <div class="answer" id="m1u1-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m1u1-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m1u1-remembered">已记住</button>
                    <button class="not-remembered" id="m1u1-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m1u2-words" class="word-container hidden">
        <div class="progress">进度: <span id="m1u2-progress">0</span>/<span id="m1u2-total">0</span> (<span id="m1u2-completed">0</span> 已记住)</div>
        <div id="m1u2-card" class="card">
            <div class="chinese" id="m1u2-chinese"></div>
            <div class="answer" id="m1u2-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m1u2-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m1u2-remembered">已记住</button>
                    <button class="not-remembered" id="m1u2-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m1u3-words" class="word-container hidden">
        <div class="progress">进度: <span id="m1u3-progress">0</span>/<span id="m1u3-total">0</span> (<span id="m1u3-completed">0</span> 已记住)</div>
        <div id="m1u3-card" class="card">
            <div class="chinese" id="m1u3-chinese"></div>
            <div class="answer" id="m1u3-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m1u3-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m1u3-remembered">已记住</button>
                    <button class="not-remembered" id="m1u3-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m2u1-words" class="word-container hidden">
        <div class="progress">进度: <span id="m2u1-progress">0</span>/<span id="m2u1-total">0</span> (<span id="m2u1-completed">0</span> 已记住)</div>
        <div id="m2u1-card" class="card">
            <div class="chinese" id="m2u1-chinese"></div>
            <div class="answer" id="m2u1-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m2u1-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m2u1-remembered">已记住</button>
                    <button class="not-remembered" id="m2u1-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m2u2-words" class="word-container hidden">
        <div class="progress">进度: <span id="m2u2-progress">0</span>/<span id="m2u2-total">0</span> (<span id="m2u2-completed">0</span> 已记住)</div>
        <div id="m2u2-card" class="card">
            <div class="chinese" id="m2u2-chinese"></div>
            <div class="answer" id="m2u2-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m2u2-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m2u2-remembered">已记住</button>
                    <button class="not-remembered" id="m2u2-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m2u3-words" class="word-container hidden">
        <div class="progress">进度: <span id="m2u3-progress">0</span>/<span id="m2u3-total">0</span> (<span id="m2u3-completed">0</span> 已记住)</div>
        <div id="m2u3-card" class="card">
            <div class="chinese" id="m2u3-chinese"></div>
            <div class="answer" id="m2u3-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m2u3-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m2u3-remembered">已记住</button>
                    <button class="not-remembered" id="m2u3-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m3u1-words" >
        <div class="progress">进度: <span id="m3u1-progress">0</span>/<span id="m3u1-total">0</span> (<span id="m3u1-completed">0</span> 已记住)</div>
        <div id="m3u1-card" class="card">
            <div class="chinese" id="m3u1-chinese"></div>
            <div class="answer" id="m3u1-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m3u1-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m3u1-remembered">已记住</button>
                    <button class="not-remembered" id="m3u1-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m3u2-words" class="word-container hidden">
        <div class="progress">进度: <span id="m3u2-progress">0</span>/<span id="m3u2-total">0</span> (<span id="m3u2-completed">0</span> 已记住)</div>
        <div id="m3u2-card" class="card">
            <div class="chinese" id="m3u2-chinese"></div>
            <div class="answer" id="m3u2-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m3u2-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m3u2-remembered">已记住</button>
                    <button class="not-remembered" id="m3u2-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m3u3-words" class="word-container hidden">
        <div class="progress">进度: <span id="m3u3-progress">0</span>/<span id="m3u3-total">0</span> (<span id="m3u3-completed">0</span> 已记住)</div>
        <div id="m3u3-card" class="card">
            <div class="chinese" id="m3u3-chinese"></div>
            <div class="answer" id="m3u3-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m3u3-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m3u3-remembered">已记住</button>
                    <button class="not-remembered" id="m3u3-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m4u1-words" class="word-container hidden">
        <div class="progress">进度: <span id="m4u1-progress">0</span>/<span id="m4u1-total">0</span> (<span id="m4u1-completed">0</span> 已记住)</div>
        <div id="m4u1-card" class="card">
            <div class="chinese" id="m4u1-chinese"></div>
            <div class="answer" id="m4u1-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m4u1-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m4u1-remembered">已记住</button>
                    <button class="not-remembered" id="m4u1-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m4u2-words" class="word-container hidden">
        <div class="progress">进度: <span id="m4u2-progress">0</span>/<span id="m4u2-total">0</span> (<span id="m4u2-completed">0</span> 已记住)</div>
        <div id="m4u2-card" class="card">
            <div class="chinese" id="m4u2-chinese"></div>
            <div class="answer" id="m4u2-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m4u2-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m4u2-remembered">已记住</button>
                    <button class="not-remembered" id="m4u2-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="m4u3-words" class="word-container hidden">
        <div class="progress">进度: <span id="m4u3-progress">0</span>/<span id="m4u3-total">0</span> (<span id="m4u3-completed">0</span> 已记住)</div>
        <div id="m4u3-card" class="card">
            <div class="chinese" id="m4u3-chinese"></div>
            <div class="answer" id="m4u3-answer"></div>
            <div class="buttons">
                <button class="show-answer" id="m4u3-show-answer">显示答案</button>
                <div class="action-buttons">
                    <button class="remembered" id="m4u3-remembered">已记住</button>
                    <button class="not-remembered" id="m4u3-not-remembered">未记住</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="not-remembered-list" class="not-remembered-list">
        <h3>未记住的单词清单</h3>
        <ul id="not-remembered-words"></ul>
    </div>

    <form class="email-form" id="email-form">
        <div class="email-form-group">
            <label for="user-email">请输入您的邮箱地址：</label>
            <input type="email" id="user-email" class="email-input" required placeholder="example@163.com">
        </div>
        <input type="hidden" name="_subject" value="未记住的单词清单">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="未记住的单词" id="email-words">
        <button type="submit" class="finish-btn">发送到邮箱</button>
    </form>

    <div class="footer-buttons">
        <button class="reset-btn" id="reset-all">重置所有进度</button>
        <button class="finish-btn" id="finish-session">结束本次打卡</button>
    </div>

    <script>
        // 全局变量
        let wordData = {};
        let currentModule = 'm1u1';
        let currentType = 'words';
        let notRememberedWords = [];
        const modules = {};

        // 初始化应用
        async function initializeApp() {
            try {
                const response = await fetch('word-data.mime');
                if (!response.ok) throw new Error('Network response was not ok');
                wordData = await response.json();
                
                // 确保wordData结构正确
                console.log("Loaded word data:", wordData);
                
                initializeModules();
                initializeEventListeners();
                
                // 初始化所有模块
                Object.keys(modules).forEach(module => {
                    ['words', 'phrases', 'sentences'].forEach(type => {
                        if (wordData[module] && wordData[module][type]) {
                            initModule(module, type);
                        }
                    });
                });
                
                switchModule('m1u1');
                switchType('words');
            } catch (error) {
                console.error('加载单词数据失败:', error);
                alert('加载单词数据失败，请检查网络连接或数据文件是否存在。');
            }
        }

        // 初始化所有模块
        function initializeModules() {
            const moduleIds = ['m1u1', 'm1u2', 'm1u3', 'm2u1', 'm2u2', 'm2u3', 'm3u1', 'm3u2', 'm3u3', 'm4u1', 'm4u2', 'm4u3'];
            const types = ['words', 'phrases', 'sentences'];
            
            moduleIds.forEach(module => {
                modules[module] = {};
                
                types.forEach(type => {
                    modules[module][type] = {
                        words: [],
                        remembered: [],
                        currentIndex: 0,
                        element: document.getElementById(`${module}-words`),
                        chinese: document.getElementById(`${module}-chinese`),
                        answer: document.getElementById(`${module}-answer`),
                        showAnswerBtn: document.getElementById(`${module}-show-answer`),
                        rememberedBtn: document.getElementById(`${module}-remembered`),
                        notRememberedBtn: document.getElementById(`${module}-not-remembered`),
                        progress: document.getElementById(`${module}-progress`),
                        total: document.getElementById(`${module}-total`),
                        completed: document.getElementById(`${module}-completed`)
                    };
                });
            });
        }

        // 初始化事件监听器
        function initializeEventListeners() {
            // 模块选择按钮
            document.querySelectorAll('.module-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchModule(btn.dataset.module);
                });
            });

            // 内容类型选择按钮
            document.querySelectorAll('.word-type-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchType(btn.dataset.type);
                });
            });

            // 重置和结束按钮
            document.getElementById('reset-all').addEventListener('click', resetAllProgress);
            document.getElementById('finish-session').addEventListener('click', finishSession);

            // 为每个模块添加事件监听
            const moduleIds = ['m1u1', 'm1u2', 'm1u3', 'm2u1', 'm2u2', 'm2u3', 'm3u1', 'm3u2', 'm3u3', 'm4u1', 'm4u2', 'm4u3'];
            moduleIds.forEach(module => {
                document.getElementById(`${module}-show-answer`).addEventListener('click', () => showAnswer(module, currentType));
                document.getElementById(`${module}-remembered`).addEventListener('click', () => markAsRemembered(module, currentType));
                document.getElementById(`${module}-not-remembered`).addEventListener('click', () => markAsNotRemembered(module, currentType));
            });

            // 邮件表单提交
            document.getElementById('email-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const userEmail = document.getElementById('user-email').value;
                if (!userEmail || !userEmail.includes('@')) {
                    alert('请输入有效的邮箱地址！');
                    return;
                }
                
                const wordsData = document.getElementById('email-words').value;
                
                fetch('https://formsubmit.co/ajax/' + encodeURIComponent(userEmail), {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        _subject: '未记住的单词清单',
                        _template: 'table',
                        '未记住的单词': wordsData
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success === "true") {
                        alert('邮件发送成功！');
                        this.reset();
                        document.getElementById('not-remembered-list').style.display = 'none';
                        this.style.display = 'none';
                    } else {
                        alert('邮件发送失败，请稍后再试。');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('邮件发送失败，请检查网络连接。');
                });
            });
        }

        // 从LocalStorage加载模块数据
        function loadModuleData(module, type) {
            const savedData = localStorage.getItem(`wordReview_${module}_${type}`);
            return savedData ? JSON.parse(savedData) : null;
        }

        // 保存模块数据到LocalStorage
        function saveModuleData(module, type, data) {
            localStorage.setItem(`wordReview_${module}_${type}`, JSON.stringify(data));
        }

        // 初始化模块
        function initModule(module, type, forceReset = false) {
            let savedData = null;
            
            if (!forceReset) {
                savedData = loadModuleData(module, type);
            }
            
            const moduleData = wordData[module];
            if (!moduleData) {
                console.error(`Module ${module} not found in wordData`);
                return;
            }
            
            const data = moduleData[type] || [];
            const m = modules[module][type];
            
            if (savedData) {
                m.words = savedData.words;
                m.remembered = savedData.remembered;
                m.currentIndex = savedData.currentIndex;
            } else {
                m.words = [...data];
                m.remembered = [];
                m.currentIndex = 0;
            }
            
            updateModuleUI(module, type);
        }

        // 更新模块UI
        function updateModuleUI(module, type) {
            const m = modules[module][type];
            const data = wordData[module]?.[type] || [];
            
            m.total.textContent = data.length;
            m.completed.textContent = m.remembered.length;
            m.progress.textContent = m.currentIndex + 1;
            
            if (m.currentIndex < m.words.length) {
                m.chinese.textContent = m.words[m.currentIndex].chinese;
                m.answer.textContent = m.words[m.currentIndex].english;
                m.answer.style.display = "none";
                m.showAnswerBtn.style.display = "block";
                m.rememberedBtn.style.display = "block";
                m.notRememberedBtn.style.display = "block";
            } else {
                m.chinese.textContent = "已完成所有内容复习！";
                m.answer.style.display = "none";
                m.showAnswerBtn.style.display = "none";
                m.rememberedBtn.style.display = "none";
                m.notRememberedBtn.style.display = "none";
            }
        }

        // 切换模块
        function switchModule(module) {
            currentModule = module;
            document.querySelectorAll('.word-container').forEach(el => {
                el.classList.add('hidden');
            });
            document.querySelectorAll('.module-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            modules[module][currentType].element.classList.remove('hidden');
            document.querySelector(`.module-btn[data-module="${module}"]`).classList.add('active');
            initModule(module, currentType);
        }

        // 切换内容类型
        function switchType(type) {
            currentType = type;
            document.querySelectorAll('.word-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.word-type-btn[data-type="${type}"]`).classList.add('active');
            initModule(currentModule, currentType);
        }

        // 显示答案
        function showAnswer(module, type) {
            const m = modules[module][type];
            m.answer.style.display = "block";
        }

        // 标记为记住
        function markAsRemembered(module, type) {
            const m = modules[module][type];
            if (m.currentIndex < m.words.length) {
                m.answer.style.display = "block";
                
                m.remembered.push(m.words[m.currentIndex]);
                m.currentIndex++;
                m.completed.textContent = m.remembered.length;
                
                saveModuleData(module, type, {
                    words: m.words,
                    remembered: m.remembered,
                    currentIndex: m.currentIndex
                });
                
                if (m.currentIndex < m.words.length) {
                    m.chinese.textContent = m.words[m.currentIndex].chinese;
                    m.answer.textContent = m.words[m.currentIndex].english;
                    m.answer.style.display = "none";
                    m.progress.textContent = m.currentIndex + 1;
                } else {
                    m.chinese.textContent = "已完成所有内容复习！";
                    m.answer.style.display = "none";
                    m.showAnswerBtn.style.display = "none";
                    m.rememberedBtn.style.display = "none";
                    m.notRememberedBtn.style.display = "none";
                }
            }
        }

        // 标记为未记住
        function markAsNotRemembered(module, type) {
            const m = modules[module][type];
            if (m.currentIndex < m.words.length) {
                m.answer.style.display = "block";
                
                const notRememberedWord = m.words[m.currentIndex];
                m.words.splice(m.currentIndex, 1);
                m.words.push(notRememberedWord);
                
                notRememberedWords.push({
                    module: module,
                    type: type,
                    word: notRememberedWord
                });
                
                saveModuleData(module, type, {
                    words: m.words,
                    remembered: m.remembered,
                    currentIndex: m.currentIndex
                });
                
                m.chinese.textContent = m.words[m.currentIndex].chinese;
                m.answer.textContent = m.words[m.currentIndex].english;
                m.answer.style.display = "none";
                m.progress.textContent = m.currentIndex + 1;
            }
        }

        // 重置模块数据
        function resetModuleData(module, type) {
            localStorage.removeItem(`wordReview_${module}_${type}`);
            initModule(module, type, true);
        }

        // 重置所有进度
        function resetAllProgress() {
            if (confirm("确定要重置所有复习进度吗？这将清除所有已记住的内容记录。")) {
                Object.keys(modules).forEach(module => {
                    ['words', 'phrases', 'sentences'].forEach(type => {
                        if (modules[module][type]) {
                            resetModuleData(module, type);
                        }
                    });
                });
                notRememberedWords = [];
                initModule(currentModule, currentType);
            }
        }

        // 结束本次打卡
        function finishSession() {
            const listElement = document.getElementById('not-remembered-words');
            listElement.innerHTML = '';
            
            if (notRememberedWords.length === 0) {
                listElement.innerHTML = '<li>本次打卡没有未记住的内容！</li>';
            } else {
                const groupedWords = {};
                notRememberedWords.forEach(item => {
                    if (!groupedWords[item.module]) {
                        groupedWords[item.module] = {};
                    }
                    if (!groupedWords[item.module][item.type]) {
                        groupedWords[item.module][item.type] = [];
                    }
                    groupedWords[item.module][item.type].push(item.word);
                });
                
                Object.keys(groupedWords).forEach(module => {
                    const moduleTitle = document.createElement('li');
                    moduleTitle.innerHTML = `<strong>${module.toUpperCase()}</strong>`;
                    listElement.appendChild(moduleTitle);
                    
                    Object.keys(groupedWords[module]).forEach(type => {
                        const typeTitle = document.createElement('li');
                        typeTitle.innerHTML = `<em>${getTypeName(type)}</em>`;
                        listElement.appendChild(typeTitle);
                        
                        groupedWords[module][type].forEach(word => {
                            const wordItem = document.createElement('li');
                            wordItem.textContent = `${word.chinese} - ${word.english}`;
                            listElement.appendChild(wordItem);
                        });
                    });
                });
                
                let emailContent = '';
                Object.keys(groupedWords).forEach(module => {
                    emailContent += `${module.toUpperCase()}:\n`;
                    Object.keys(groupedWords[module]).forEach(type => {
                        emailContent += `  ${getTypeName(type)}:\n`;
                        groupedWords[module][type].forEach(word => {
                            emailContent += `    - ${word.chinese} - ${word.english}\n`;
                        });
                    });
                    emailContent += '\n';
                });
                document.getElementById('email-words').value = emailContent;
            }
            
            document.getElementById('not-remembered-list').style.display = 'block';
            document.getElementById('email-form').style.display = 'block';
        }

        // 获取类型名称
        function getTypeName(type) {
            return {
                'words': '单词',
                'phrases': '词组',
                'sentences': '句子'
            }[type];
        }

        // 启动应用
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
